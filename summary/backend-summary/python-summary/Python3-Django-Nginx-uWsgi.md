# Ubuntu 14.04使用Nginx以及uWsgi运行Django应用## 安装python以及对应的python-pip，此处使用python3``` bashsudo apt-get update# python 3sudo apt-get install python3-pip# python 2sudo apt-get install python-pip```## 安装virtualenv环境``` python# python 3sudo pip3 install virtualenv virtualenvwrapper# python 2sudo pip install virtualenv virtualenvwrapper```## 设置bash环境``` bash# 如果安装的是python 3，额外需要下面的一句，告知virtualwrapper使用python 3echo "export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3" >> ~/.bashrc# 下面的哪个版本都需要# 告知virtualwrapper虚拟环境目录是Envecho "export WORKON_HOME=~/Env" >> ~/.bashrc# 运行virtualwrapper脚本echo "source /usr/local/bin/virtualenvwrapper.sh" >> ~/.bashrc# 当前环境重新编译bashrc文件source ~/.bashrc```## 创建虚拟环境firstProj``` bashmkvirtualenv firstProj# 如果工作环境变成(firstProj)user@hostname:~$，就安装djangopip3 install django# 安装完成，启动项目cd ~django-admin.py startproject firstProj   # 项目名跟虚拟环境名称相同有利于下面的工作cd ~/firstProj./manage.py migrate./manage.py createsuperuservim firstProj/settings.py   # 打开文件后在最后一行加上 `STATIC_ROOT = os.path.join(BASE_DIR, "static/")`./manage.py collectstatic# 尝试运行项目./manage.py runserver 0.0.0.0:8080# 工作正常的话用Ctrl-C结束程序# 虚拟环境的一些命令deactivate                  # 离开虚拟环境workon firstProj            # 回到虚拟环境rmvirtualenv firstProj      # 删除虚拟环境```## 离开虚拟环境后全局安装uwsgi``` bash# 首先安装python-dev# python 2sudo apt-get install python-dev# python 3sudo apt-get install python3-dev# 安装uwsgi# python 2sudo pip install uwsgi# python 3sudo pip3 install uwsgi# 尝试使用uwsgiuwsgi --http :8080 --home /home/path/to/Env/firstProj --chdir /home/path/to/firstProj -w firstProj.wsgi```## 编写uwsgi配置文件``` bashsudo mkdir -p /etc/uwsgi/sitescd /etc/uwsgi/sitessudo vim firstProj.ini# 以下内容是进入编写界面后输入的内容[uwsgi]project = firstProj  # firstProj替换成相应的项目名称，这里的参数可以用%()引用，如下：base = /home/user    # user是指用户路径chdir = %(base)/%(project)home = %(base)/Env/%(project)module = %(project).wsgi:applicationmaster = trueprocesses = 5socket = %(base)/%(project)/%(project).sock   # uwsgi支持其他协议，这里用sockchmod-socket = 664vacuum = true# 保存文件后退出```## 创建启动uwsgi的上层脚本``` bashsudo vim /etc/init/uwsgi.conf# 打开文件后填入以下内容description "uWSGI application server in Emperor mode"start on runlevel [2345]stop on runlevel [!2345]setuid usersetgid www-data   # 安装完Nginx后才有exec /usr/local/bin/uwsgi --emperor /etc/uwsgi/sites   # 用uwsgi启动sites下的每个项目# 保存文件后退出```## 安装Nginx作反向代理``` bashsudo apt-get install nginxsudo vim /etc/nginx/sites-available/firstProj# 以下填入打开的文件中server {    listen 80;  # 端口随意填写    server_name firstProj.com www.firstProj.com 123.123.123.123 ""; # 可以用域名，也可以用IP地址，或者空字符串    location = /favicon.ico { access_log off; log_not_found off; } # 防止nginx记录没有favicon.ico的错误信息    location /static/ {        root /home/user/firstProj;  # 路径需要确认正确    }    location / {        include uwsgi_params;        uwsgi_pass unix:/home/user/firstProj/firstProj.sock; # 路径确保正确    }}# 退出并保存文件# 建立软连接到nginx启动文件夹sudo ln -s /etc/nginx/sites-available/firstProj /etc/nginx/sites-enabled# 测试配置是否正确sudo service nginx configtest# 重新启动nginx服务sudo service nginx restart# 启动uwsgi服务sudo service uwsgi start```***遇到问题可以查看nginx的报错信息：```vim /var/log/nginx/error.log```一般是路径配置错误，或者可以运行uwsgi查看报错信息