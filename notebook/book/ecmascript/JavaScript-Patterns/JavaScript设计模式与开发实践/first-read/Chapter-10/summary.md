# 组合模式

用途：组合模式将对象组合成树形结构，以表示“部分-整体”的层次结构。除了用来表示树形结构外，另一个好处是通过对象的多态表现，使得用户对单个对象和组合对象的使用具有一致性。

组合对象与基本对象需要有共同的执行方法。

***

透明性也会带来安全上的问题，因为组合对象跟叶对象没有具有相同的执行方法，因此在添加这个方法上就需要在叶对象上增加一个错误提示。

## 值得注意的地方

1. 组合模式不是父子关系，组合对象和页对象是一种HAS-A的关系，而不是IS-A的关系，组合对象把请求委托给所包含的所有叶对象，而两者能够合作的关键是拥有**相同的接口**
2. 对一组叶对象的操作必须具有一致性，只有用一致的方式对待列表中的每个叶对象的时候，才适合使用组合模式。
3. 双向映射关系：对象之间的关系并不是严格意义上的层次结构的话，是不适合使用组合模式的。如：一个对象，既受A对象的管理，又受B对象的管理。这种情况就不适合组合模式，如果这时候还是需要使用组合模式，必须要在上下层间建立双向映射关系，这会增加对象间的耦合性，这个时候或许就需要引入中介者模式来管理这些对象了。
4. 用职责链模式提高组合模式性能：使用职责链模式，能够避免对整个组合树进行遍历，且由于在组合模式中上下层间形成了天然的职责链，可以让请求顺着链条从父对象向子对象传递，或是反过来从子对象向父对象传递。

## 何时使用

一般来说适用于以下两种情况：
    1. 表示对象的部分-整体层次结构，在树的构造最终完成之后，只需要通过请求树的最顶层对象，便能够对整棵树做统一操作。组合模式删除或增加树的节点非常方便（其实就是一个多叉树结构吧），符合封闭-开放原则。
    2. 希望统一对树中的所有对象。组合模式中使客户忽略组合对象与叶对象的区别，无需多个if、else来分别处理对象。组合对象与叶对象会做各自正确的事情。
