# 代码的艺术

## 第三章

一流代码的特性:

- 高效( Fast )
- 鲁棒( Solid and Robust )
- 简洁( Maintainable and Simple )
- 简短( Small )
- 共享( Re-usable )
- 可测试( Testable )
- 可移植( Portable )
- 可监控( Maintorable )
- 可运维( Operational )
- 可扩展( Scalable & Extensible )

总的来说, 需要具备:

- 正确和性能
- 可读和可维护
- 可运维和运营
- 可共享和重用

## 第四章

好代码是多个环节循环的结果:

- 编码前: 需求分析, 系统设计
- 编码中: 编写代码, 单元测试
- 编码后: 集成测试, 上线, 持续运营/迭代改进

好系统/产品是以上过程持续循环的结果

### 需求分析, 系统设计

#### 需求分析

**需求分析**: 定义系统/软件**黑盒**的行为, 也就是外部表现( external, what )

需求分析需要勾勒出系统的功能, 用精确的数字来刻画.

#### 系统设计

**系统设计**: 设计系统/软件**白盒**的机制, 也就是内部表现, 系统是怎么实现的, 以及为什么要这么做( internal, how & why )

系统设计涉及到系统架构, 系统架构指的是系统的概念模型, 定义了系统的结构, 行为以及系统的更多的视图.

其中系统的一些设计要素有:

- 系统需要完成哪些功能
- 系统如何组成
- 功能在这些组成部分之间如何划分

系统设计中还需要注意一些约束:

- 资源的限制: 计算资源, IO/网络资源, 存储资源
- 需求是系统设计决策的来源: 在设计中需要经常做权衡, 需求是决策的重要依据

系统设计中每个组建(子系统/模块)的功能应该足够的专注和单一. **功能单一是复用和扩展的基础**

子系统/模块之间的关系应该简单而清晰. **软件中最复杂的是耦合**

**关于接口**, 系统对外的接口, 比系统实现本身更重要. 原因是: 接口定义了功能, 功能不正确, 系统就无用了. 其次, 接口定义了和外部的关系, 外部关系一旦确认后非常难以修改.

## 第五章

### 代码也是一种表达方式

项目中50%的时间用于沟通, 而且软件的维护成本远高于开发成本.

因此需要变成规范, 里面需要包括代码如何规范表达, 以及语言相关的注意事项

### 模块

模块是程序的基本组成单位, 需要有明确的功能, 达到紧内聚, 松耦合.

切分模块的一种角度可以按照: 数据类, 过程类 来进行.

**数据类的模块**主要完成对数据的封装, 数据一般可以认为是模块或类的内部变量. 对外需要提供明确的数据访问接口, 数据结构和算法属于模块内部的工作.

写程序需要以**数据为中心**考虑

**过程类模块**本身不含数据, 调用"数据类模块" 或 "过程类模块". 好的模块划分是软件架构稳定的基础, 稳定的模块功能/接口能使得软件的架构稳定.

所以需要减少模块间的耦合, 以降低软件复杂性. 清晰的模块有利于代码的复用.

### 类和函数

**类**和**函数**是两种不同的模型, 有它们各自**适用**的范围

过程类的模块中和类成员变量**无关**的函数, 最好作为一个独立的函数, 便于复用.

Object Oriented 的本质是**数据封装**

#### 模块内部组成

- 文件头
  - 模块的说明: 模块功能的简要说明
  - 修改历史: 时间, 修改人, 修改内容
  - 其他必要的, 模块级别的说明
- 模块内, **内容的顺序**尽量保持一致
  - 文件头( 对模块的说明 )
  - 包含文件的说明
  - 全局变量/全局常量
  - 内部函数
  - 外部可访问的函数
  - 类的实现

## 第六章

### 函数

函数的切分很重要, 函数描述有三个要素:

- 功能描述: 函数能做什么
- 传入参数描述: 含义, 限制条件
- 返回值的描述: 各种可能性

函数的规模要足够短小

**函数的返回值**:

每个函数应该有足够明确的**语义**, 而基于函数的语义, 函数返回值有三种类型:

- Boolean, "逻辑判断型"函数, 表示 "真" 或者 "假"
- OK, ERROR, "操作型函数"函数, 表示 "成功" 或者 "失败"
- Date, None, "获取数据型"函数, 表示 "有数据" 或 "无数据/获取数据失败"

函数最好是**单入口, 单出口**的形式， 尤其是多线程下数据表的实现， 最好使用一个内部函数来实现 “单入口， 单出口”

#### 代码块

这里指的是一个函数内一段代码的实现， 需要把**代码的段落**分清楚， 形式的背后表达的是对逻辑(划分, 层次)的理解

#### 命名

命名为什么重要, 是因为通过命名能够快速得到简要的信息, 不恰当的名字会导致错误的理解, 得到错误的概念, 而概念是建立模型的出发点. 而系统是由概念定义组成的, 概念则是通过逻辑推理实现模型体系, 因此好的命名是系统设计的基础.

命名中应该避免的问题:

- 名称不携带信息
- 名称携带的信息是错误的

因此命名需要:

- 准确, 易懂
- 命名时需要进行推敲
- 遵循命名规范, 类名大写开头等

#### 互联网的系统是运营出来的

代码的**可监测性**非常重要, 需要暴露足够的接口进行数据收集. 对于系统来说, **数据**和**功能**同等重要, 因为:

- 功能可以依靠线下测试来验证
- 数据只能依靠线上的运转和运营来验证和发现问题

所以在设计和编码阶段就需要考虑系统的运营, 去提供足够的状态记录数据, 也提供方便的对外接口读取数据.

## 第七章

### 成为优秀的软件工程师

要成为优秀的软件工程师需要注意三个方面:

- 学习 -> 思考 -> 实践
- 知识 -> 方法 -> 精神
- 基础是治学的根本

软件工程师需要的基础能力:

- 数据结构, 算法, 操作系统, 系统结构, 计算机网络
- 软件工程, 变成思想
- 逻辑思维能力, 归纳总结能力, 表达能力
- 研究能力, 分析问题, 解决问题

好代码的来源 不是 写好代码, 好代码是一系列工作的结果: 需求分析, 系统设计, 系统的持续运营的结果. 代码需要写给人看, 让人读懂的.

### 推荐的数目:

- Code Complete
- Rapid Development
- The Mythical Man-Month (人月神话)
- 201 Principles of software development (201个原理 / 软件开发201个原理)

#### 操作系统相关:

- Computer Organization and Architecture (计算机组织结构)
- Operating Systems Internals and Principles (操作系统精髓)
- Operating Systems Design and Implementation (操作系统设计原理与实现)
- Computer Networks (计算机网络)
- TCP/IP Illustated (TCP/IP详解)