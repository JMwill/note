# 第六章: 库和API设计

## 保持一致的约定

在开发库和API时, 保持接口接受参数的一致性是十分重要的, 这能够方便使用者使用库减少学习难度.

## 将'undefined'看做没有值

- 避免用undefined来表示任何非特定值
- 使用描述性的字符串值或命名布尔属性的对象, 而不要使用undefined或null来代表特定应用标志
- 提供参数默认值应当采用测试undefined的方式, 而不是检查arguments.length, 因为传参时, 如果指定参数为undefined, 则参数长度也会响应改变
- 在允许0, NaN或者空字符串为有效参数的地方, 不要通过真值测试来实现参数默认值, 即`param || 'default'`这样的形式.

## 接收关键字参数的选项对象

- 使用选项对象使得API更具有可读性, 更容易记忆
- 所有通过选项对象提供的参数应当被视为可选的
- 使用extend函数抽象出选项对象中提取值的逻辑

## 避免不必要的状态

API可以用状态来将其归为两类, 一类是有状态的API, 一类是无状态的API

**无状态**API提供的函数或方法的行为只取决于输入, 与程序的状态改变无关. 如字符串的`'hello'.tuUpperCase()`总是输出`HELLO`.

**有状态**API意味着对于相同的调用, 根据内部状态的不同会产出不同的结果, 如Date对象的函数.

- 因此设计API时, 尽可能将其设置为无状态的. 尽可能使用无状态的API
- 如果API是有状态的, 标示出每个操作与哪些状态有关联. 或者在使用时, 将其封装成一个无状态的API

## 使用结构类型(鸭子类型)设计灵活的接口

- 一个调用某个对象方法的函数能够与任何实现了相同接口的对象一起工作
- 结构接口更灵活, 更轻量, 可以避免使用繁琐的继承
- 在单元测试时, 可以使用mock对象即接口的替代实现来提供可复验的行为